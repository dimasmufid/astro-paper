<script is:inline>
  const POSTHOG_KEY = "phc_aCiyzmoQpmFrFtsNQ8FzoE8PmiDkFjcVwJmJTz1kaB2";
  const POSTHOG_HOST = "https://us.i.posthog.com";
  const POSTHOG_SCRIPT_ID = "posthog-js";

  const initPosthog = () => {
    if (
      typeof window === "undefined" ||
      window.__posthogInitialized ||
      !window.posthog?.init
    ) {
      return;
    }

    window.posthog.init(POSTHOG_KEY, {
      api_host: POSTHOG_HOST,
      defaults: "2025-05-24",
      person_profiles: "identified_only", // or 'always' to create profiles for anonymous users as well
    });
    window.__posthogInitialized = true;
  };

  const loadPosthog = () => {
    if (typeof window === "undefined") {
      return;
    }

    initPosthog();
    if (window.__posthogInitialized) {
      return;
    }

    const scriptUrl = `${POSTHOG_HOST.replace(
      ".i.posthog.com",
      "-assets.i.posthog.com"
    )}/static/array.js`;

    const existingScript = document.getElementById(POSTHOG_SCRIPT_ID);
    if (existingScript instanceof HTMLScriptElement) {
      existingScript.addEventListener("load", initPosthog, { once: true });
      return;
    }

    const script = document.createElement("script");
    script.id = POSTHOG_SCRIPT_ID;
    script.async = true;
    script.crossOrigin = "anonymous";
    script.src = scriptUrl;
    script.addEventListener("load", initPosthog, { once: true });
    document.head.append(script);
  };

  loadPosthog();
</script>
